{"version":3,"sources":["../../src/shared/map-component/search-address/search-address.module.ts","../../src/shared/map-component/search-address/search-address.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { SearchAddress } from './search-address';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    SearchAddress,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(SearchAddress),\r\n  ],\r\n  exports: [\r\n    SearchAddress\r\n  ]\r\n})\r\nexport class SearchAddressModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/map-component/search-address/search-address.module.ts","import {Component, ViewChild} from '@angular/core';\r\nimport {IonicPage, ViewController, NavParams, Searchbar} from 'ionic-angular';\r\nimport {Subject} from \"rxjs\";\r\nimport {NativeService} from \"../../../providers/NativeService\";\r\nimport {Storage} from '@ionic/storage';\r\ndeclare var AMap;\r\n/**\r\n * Generated class for the SearchAddress page.\r\n *\r\n * See http://ionicframework.com/docs/components/#navigation for more info\r\n * on Ionic pages and navigation.\r\n */\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-search-address',\r\n  templateUrl: 'search-address.html',\r\n})\r\nexport class SearchAddress {\r\n\r\n  @ViewChild('searchBar') searchBar: Searchbar;\r\n  address: any = '';\r\n  // searchQuery: string = '';\r\n  items: any[] = [];\r\n  placeSearch;\r\n  searchTextStream: Subject<string> = new Subject<string>();\r\n\r\n  constructor(private storage: Storage,\r\n              public viewCtrl: ViewController,\r\n              private navParams: NavParams,\r\n              private nativeService: NativeService,) {\r\n    this.address = this.navParams.get('address');\r\n    AMap.service('AMap.PlaceSearch', () => {//地点查询插件\r\n      this.placeSearch = new AMap.PlaceSearch({\r\n        pageSize: 10,\r\n        pageIndex: 1,\r\n        city: '广州市'\r\n      });\r\n    });\r\n    this.storage.get('MapSearchHistory').then(items => {\r\n      this.items = (items || []).reverse();\r\n    });\r\n  }\r\n\r\n  ionViewDidEnter() {\r\n    setTimeout(() => {\r\n      this.searchBar.setFocus();\r\n    });\r\n  }\r\n\r\n  ngAfterContentInit() {\r\n    this.searchTextStream\r\n      .debounceTime(600)\r\n      .distinctUntilChanged()\r\n      .subscribe(value => {\r\n        this.getSearchData(value).then(list => this.items = <[any]>list);\r\n      });\r\n    this.searchTextStream.next(this.address);\r\n  }\r\n\r\n  getItems($event) {\r\n    this.searchTextStream.next($event.target.value);\r\n  }\r\n\r\n  selectItem(item) {\r\n    this.storage.get('MapSearchHistory').then(items => {\r\n      if (items) {\r\n        let isExist = false;\r\n        for (let value of items) {\r\n          if (value.id === item.id) {\r\n            isExist = true;\r\n          }\r\n        }\r\n        if (!isExist) {\r\n          items.push(item);\r\n        }\r\n      } else {\r\n        items = [item]\r\n      }\r\n      this.storage.set('MapSearchHistory', items);\r\n    });\r\n    this.viewCtrl.dismiss(item);\r\n  }\r\n\r\n  clearHistory() {\r\n    this.storage.remove('MapSearchHistory');\r\n    this.items = [];\r\n  }\r\n\r\n  private getSearchData(val) {\r\n    return new Promise((resolve) => {\r\n      if (val && val.trim() != '') {\r\n        this.placeSearch.search(val, (status, result) => {\r\n          if (status == 'complete') {\r\n            resolve(result.poiList.pois);\r\n          } else if (status == 'no_data') {\r\n            this.nativeService.showToast('没有找到匹配结果,请精确查询条件')\r\n          } else {\r\n            this.nativeService.showToast('地图查询失败,稍后再试.')\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  dismiss() {\r\n    this.viewCtrl.dismiss();\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/map-component/search-address/search-address.ts"],"sourceRoot":""}